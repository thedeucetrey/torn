<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Undercurrent Game UI with Business Pyramid</title>
<style>
  /* Reset and base styles */
  body, html {
    margin: 0;
    padding: 0;
    height: 100%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f0f0f0;
    color: #222;
  }
  #container {
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
  }
  #banner {
    flex: 0 0 90px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: #000;
  }
  #banner img {
    max-height: 90px;
    width: auto;
  }
  #banner-username-logout {
    position: absolute;
    top: 10px;
    right: 30px;
    display: flex;
    align-items: center;
    gap: 15px;
    font-size: 18px;
    color: white;
  }
  #logout-btn {
    background-color: #facc15;
    border: none;
    padding: 5px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 600;
    color: #162f44;
    transition: background-color 0.3s;
  }
  #logout-btn:hover {
    background-color: #e6b70b;
  }
  #main {
    display: flex;
    flex: 1;
    height: calc(100vh - 90px);
  }
  #toolbar {
    background: #162f44;
    color: #cbd5e1;
    width: 220px;
    padding: 20px 20px 0 20px;
    box-sizing: border-box;
    box-shadow: 2px 0 5px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #toolbar-logo {
    width: 140px;
    margin-bottom: 20px;
    border-radius: 8px;
    box-shadow: 0 0 10px #facc15;
  }
  #toolbar ul {
    list-style: none;
    padding: 0;
    margin: 0;
    width: 100%;
  }
  #toolbar ul li {
    padding: 15px 25px;
    cursor: pointer;
    border-left: 4px solid transparent;
    transition: background-color 0.3s, border-color 0.3s;
    font-weight: 600;
    user-select: none;
  }
  #toolbar ul li:hover {
    background-color: #1f496d;
    border-left-color: #facc15;
    color: #fff;
  }
  #toolbar ul li.active {
    background-color: #facc15;
    color: #162f44;
    border-left-color: #facc15;
  }
  #console {
    background: #fff;
    flex: 1;
    padding: 30px;
    box-sizing: border-box;
    overflow-y: auto;
    box-shadow: inset 0 0 10px #d1d5db;
  }
  #console h2 {
    margin-top: 0;
    font-weight: 700;
    color: #0b1922;
    border-bottom: 2px solid #facc15;
    padding-bottom: 6px;
  }
  #console p {
    font-size: 16px;
    line-height: 1.5;
  }
  form {
    max-width: 400px;
  }
  label {
    display: block;
    margin-top: 15px;
    font-weight: 600;
  }
  input[type="text"], input[type="password"], input[type="number"], select {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
    box-sizing: border-box;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 14px;
  }
  input[type="submit"], button.action-btn {
    margin-top: 20px;
    background-color: #facc15;
    border: none;
    padding: 10px;
    width: 100%;
    border-radius: 4px;
    font-weight: 700;
    font-size: 16px;
    color: #162f44;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  input[type="submit"]:hover, button.action-btn:hover {
    background-color: #e6b70b;
  }
  #login-error {
    color: red;
    margin-top: 10px;
  }
  /* Business Dashboard Styles */
  .business-container {
    max-width: 700px;
    margin: auto;
  }
  .business-header {
    margin-bottom: 20px;
  }
  .business-list, .market-list {
    margin-top: 10px;
  }
  .business-item, .market-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 12px;
    border-bottom: 1px solid #ddd;
    align-items: center;
  }
  .business-item:last-child, .market-item:last-child {
    border-bottom: none;
  }
  .business-item div, .market-item div {
    flex: 1;
  }
  .production-controls {
    margin-top: 20px;
  }
  .production-controls label {
    font-weight: 600;
  }
</style>
</head>
<body>
  <div id="container">
    <header id="banner" role="banner">
      <img src="undercurrent_banner_728x90.png" alt="Undercurrent Banner" />
      <div id="banner-username-logout" aria-live="polite">
        <div id="username-display"></div>
        <button id="logout-btn" style="display:none;" aria-label="Logout">Logout</button>
      </div>
    </header>
    <div id="main">
      <nav id="toolbar" aria-label="Main Navigation" style="display:none;">
        <img id="toolbar-logo" src="2f1feed3-7496-4292-b14f-0360853a9e0a.png" alt="Undercurrent Logo" />
        <ul id="menu-list"></ul>
      </nav>
      <main id="console" tabindex="0" role="region" aria-live="polite">
        <!-- Login or other content goes here -->
      </main>
    </div>
  </div>

<script>
  // Mock user database and business data
  const users = {
    admin: {
      password: 'admin123',
      role: 'admin',
      profile: {
        username: 'Admin',
        avatar: 'https://via.placeholder.com/100?text=Admin',
        rank: 'Administrator',
        level: 99,
      },
      businesses: []
    },
    player1: {
      password: 'player123',
      role: 'player',
      profile: {
        username: 'PlayerOne',
        avatar: 'https://via.placeholder.com/100?text=Player1',
        rank: 'Entrepreneur',
        level: 12,
      },
      businesses: [
        {
          id: 1,
          name: 'Iron Ore Mining Co.',
          type: 'Mining',
          inventory: { 'Iron Ore': 100 },
          productionQueue: [],
          cash: 50000
        }
      ]
    }
  };

  // Item definitions with production recipes
  const items = {
    'Iron Ore': { type: 'raw' },
    'Steel': { type: 'component', requires: { 'Iron Ore': 5 } },
    'Brake Part': { type: 'component', requires: { 'Steel': 2 } },
    'Paint': { type: 'component', requires: { 'Chemicals': 3 } },
    'Car': { type: 'product', requires: { 'Brake Part': 4, 'Paint': 20, 'Steel': 50 } }
  };

  // Chemicals for paint example, held by a business or open market (simplified)
  const marketInventory = {
    'Chemicals': { price: 10, quantity: 1000 }
  };

  const bannerUsername = document.getElementById('username-display');
  const logoutBtn = document.getElementById('logout-btn');
  const toolbar = document.getElementById('toolbar');
  const consoleDiv = document.getElementById('console');
  const menuList = document.getElementById('menu-list');

  const mainMenus = ['Home', 'Profile', 'Business', 'Market', 'Settings'];

  // Basic content templates
  const contentMap = {
    Home: '<h2>Home</h2><p>Welcome to Undercurrent economy simulation! Explore your businesses, the market, and build your empire.</p>',
    Profile: '', // dynamic user profile
    Settings: '<h2>Settings</h2><p>Update your preferences here.</p>'
  };

  // Show login form
  function showLoginForm() {
    toolbar.style.display = 'none';
    logoutBtn.style.display = 'none';
    bannerUsername.textContent = '';
    menuList.innerHTML = '';
    consoleDiv.innerHTML = `
      <h2>Login</h2>
      <form id="login-form" autocomplete="off">
        <label for="username">Username:</label>
        <input id="username" type="text" required autofocus />
        <label for="password">Password:</label>
        <input id="password" type="password" required />
        <input type="submit" value="Login" />
        <div id="login-error"></div>
      </form>
    `;
    document.getElementById('login-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      authenticateUser(username, password);
    });
  }

  // Authenticate user
  function authenticateUser(username, password) {
    const errorDiv = document.getElementById('login-error');
    if(users[username] && users[username].password === password) {
      localStorage.setItem('loggedInUser', username);
      localStorage.setItem('userRole', users[username].role);
      errorDiv.textContent = '';
      loadUserUI(username, users[username].role);
    } else {
      errorDiv.textContent = 'Invalid username or password.';
    }
  }

  // Load user interface after login
  function loadUserUI(username, role) {
    bannerUsername.textContent = `Logged in as: ${username}`;
    logoutBtn.style.display = 'inline-block';
    toolbar.style.display = 'flex';

    menuList.innerHTML = '';
    mainMenus.forEach(menu => {
      const li = document.createElement('li');
      li.textContent = menu;
      li.tabIndex = 0;
      if(menu === 'Home') li.classList.add('active');
      menuList.appendChild(li);
    });

    if(role === 'admin') {
      const adminLi = document.createElement('li');
      adminLi.textContent = 'Admin';
      adminLi.tabIndex = 0;
      menuList.appendChild(adminLi);
    }

    updateConsoleContent('Home', username);
    addMenuListeners(username);
  }

  // Add event listeners for menus
  function addMenuListeners(username) {
    const items = document.querySelectorAll('#menu-list li');
    items.forEach(item => {
      item.addEventListener('click', () => {
        setActiveMenu(item);
        updateConsoleContent(item.textContent, username);
      });
      item.addEventListener('keydown', e => {
        if(e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          item.click();
        }
      });
    });
  }

  // Set active menu visual
  function setActiveMenu(selectedItem) {
    const items = document.querySelectorAll('#menu-list li');
    items.forEach(item => item.classList.remove('active'));
    selectedItem.classList.add('active');
  }

  // Update main console area
  function updateConsoleContent(name, username) {
    if(name === 'Profile') {
      // Show simple profile info
      const p = users[username].profile;
      consoleDiv.innerHTML = `
        <h2>Profile</h2>
        <p><strong>Username:</strong> ${p.username}</p>
        <p><strong>Rank:</strong> ${p.rank}</p>
        <p><strong>Level:</strong> ${p.level}</p>
      `;
    } else if (name === 'Business') {
      renderBusinessDashboard(username);
    } else if(name === 'Market') {
      renderMarket(username);
    } else if(name === 'Admin') {
      consoleDiv.innerHTML = '<h2>Admin Panel</h2><p>Admin controls go here.</p>';
    } else {
      consoleDiv.innerHTML = contentMap[name] || '<p>Content not available.</p>';
    }
    consoleDiv.focus();
  }

  // Render business dashboard UI for user
  function renderBusinessDashboard(username) {
    const user = users[username];
    if(!user.businesses.length) {
      consoleDiv.innerHTML = `
        <h2>Your Businesses</h2>
        <p>You don’t own any businesses yet.</p>
        <button class="action-btn" id="create-business-btn">Create Mining Business</button>
      `;
      document.getElementById('create-business-btn').addEventListener('click', () => {
        createBusiness(username);
      });
      return;
    }
    let html = '<h2>Your Businesses</h2>';
    user.businesses.forEach(biz => {
      html += `
        <div class="business-container">
          <div class="business-header"><strong>${biz.name}</strong> (${biz.type})</div>
          <div><strong>Cash:</strong> $${biz.cash.toLocaleString()}</div>
          <h3>Inventory</h3>
          <div class="business-list">
            ${Object.entries(biz.inventory).map(([item, qty]) => `<div>${item}: ${qty}</div>`).join('')}
          </div>
          <button class="action-btn" data-bizid="${biz.id}" onclick="startMining(event)">Mine Iron Ore (+10 per run) - Cost $1000</button>
        </div>
        <hr/>
      `;
    });
    consoleDiv.innerHTML = html;
  }

  // Simple function to create a mining business for demo
  function createBusiness(username) {
    const newBiz = {
      id: Date.now(),
      name: 'Iron Ore Mining Co. ' + Date.now(),
      type: 'Mining',
      inventory: { 'Iron Ore': 0 },
      productionQueue: [],
      cash: 10000
    };
    users[username].businesses.push(newBiz);
    updateConsoleContent('Business', username);
  }

  // Simple mining action, adds Iron Ore and deducts cash
  window.startMining = function(event) {
    const btn = event.target;
    const bizId = Number(btn.getAttribute('data-bizid'));
    const username = localStorage.getItem('loggedInUser');
    const biz = users[username].businesses.find(b => b.id === bizId);
    if(!biz) return;

    if(biz.cash < 1000) {
      alert('Not enough cash to start mining.');
      return;
    }
    biz.cash -= 1000;
    biz.inventory['Iron Ore'] = (biz.inventory['Iron Ore'] || 0) + 10;
    alert('Mining complete! 10 Iron Ore added.');
    updateConsoleContent('Business', username);
  };

  // Render simple market UI for demo
  function renderMarket(username) {
    let html = `
      <h2>Market</h2>
      <p>Buy Chemicals needed for manufacturing.</p>
      <div class="market-list">
        <div class="market-item"><div>Chemicals</div><div>Price: $${marketInventory['Chemicals'].price}</div><div>Quantity Available: ${marketInventory['Chemicals'].quantity}</div><button class="action-btn" id="buy-chemicals-btn">Buy 10</button></div>
      </div>
    `;
    consoleDiv.innerHTML = html;
    document.getElementById('buy-chemicals-btn').addEventListener('click', () => {
      buyChemical(username, 10);
    });
  }

  // Buy chemicals from market and add to user's first business (simplified)
  function buyChemical(username, qty) {
    const user = users[username];
    if(!user.businesses.length) {
      alert('You need a business to buy materials.');
      return;
    }
    const marketQty = marketInventory['Chemicals'].quantity;
    if(qty > marketQty) {
      alert('Not enough Chemicals in the market.');
      return;
    }
    const biz = user.businesses[0];
    const price = marketInventory['Chemicals'].price * qty;
    if(biz.cash < price) {
      alert('Business does not have enough cash!');
      return;
    }
    marketInventory['Chemicals'].quantity -= qty;
    biz.cash -= price;
    biz.inventory['Chemicals'] = (biz.inventory['Chemicals'] || 0) + qty;
    alert(`Purchased ${qty} Chemicals for $${price}`);
    updateConsoleContent('Business', username);
  }

  logoutBtn.addEventListener('click', () => {
    localStorage.removeItem('loggedInUser');
    localStorage.removeItem('userRole');
    showLoginForm();
  });

  window.onload = function() {
    const username = localStorage.getItem('loggedInUser');
    const role = localStorage.getItem('userRole');
    if(username && role && users[username]) {
      loadUserUI(username, role);
    } else {
      showLoginForm();
    }
  };
</script>
</body>
</html>

